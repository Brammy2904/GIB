<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->

<script>
var result
var topP;
var boostDur = 60;
var leftP;
var saved_moves = "";
var position = 0;
var boostInter;
var newTop = null;
var boostInterval = null;
var newLeft = null;
let keys = {};
var turbo = true;
var speed = 6.0;
var executed = false;
const audioBoost = new Audio("https://sndup.net/xf25/d");

var Planes = [];
var Bullets = [];
class Plane{
	width;
	height;
	img;
	name;
	constructor(width, height, img, name){
		this.width = width; 
		this.height = height;
		this.img = img;
		this.name = name;
	}
	makePlane() {
		var plane = document.createElement("img")
		plane.src = this.img;
		plane.style.width = this.width +"px";
		plane.style.height = this.height +"px"
		plane.style.position = "relative";
		plane.setAttribute("id", this.name)
		plane.style.top = 400 + "px";
		plane.style.overflow = "hidden";
		plane.style.left = 400 + "px"
		plane.style.zIndex = "1"
		plane.style.transformOrigin = "center";
		document.getElementById("container").append(plane)
		topP = plane.style.top.slice("p")[0]
		leftP = plane.style.left.slice("p")[0];
	}
	Boost(){
		var boost = document.getElementById("boost")
		var value = boost.value;
		if (turbo) {
			speed = 10.0
			const audio = new Audio("https://sndup.net/xf25/d");
			audio.volume = 0.9;
			audio.play();
			turbo = false;
			document.getElementById(this.name).src = "https://iili.io/GThBNs.gif"	
			var countdown = setInterval(function() {
				boostDur = boostDur - 10;
				document.getElementById("boost").value = boostDur
				
				boost.style.background = `linear-gradient(to right, lime 0%, lime ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black 100%)`

			}, 1000)
			setTimeout(function() {
				clearInterval(countdown)
				document.getElementById(Planes[0].name).src ="https://i.pinimg.com/originals/3b/03/94/3b0394153492f7a2e31e80bb9e4c4fb5.gif"
				speed = 6.0;
				audio.pause()
				var klaar = setInterval(function() {
					boostDur = boostDur + 6;
					document.getElementById("boost").value = boostDur
					boost.style.background = `linear-gradient(to right, lime 0%, lime ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black 100%)`
				}, 1000)
				setTimeout(function() {
					clearInterval(klaar)
					turbo = true;
					

				}, 10000)
			}, 6000)
		} else {
			const audio = new Audio("https://sndup.net/nngh/d");
			audio.volume = 0.9;
			audio.play();
		}
	}
	Move() {
		var plane = document.getElementById(this.name)
		var rect = plane.getBoundingClientRect();
		saved_moves = document.getElementById(this.name).style.transform; 	
		if (Keys.up) {
			if (rect.top <= 0) {
				plane.style.top = parseInt(plane.style.top) + 6 + "px"
			}
			if (rect.bottom >= (window.innerHeight || document.documentElement.clientHeight)) {
				plane.style.top = parseInt(plane.style.top) - 6 + "px"
			}
			if (rect.left <= 0) {
				plane.style.left = parseInt(plane.style.left) + 6 + "px"
			}
			if (rect.right >= (window.innerWidth || document.documentElement.clientWidth)) {
				plane.style.left = parseInt(plane.style.left) - 6 + "px"
			} else {
				plane.style.transform += 'translateY( -' + Math.round(speed) + 'px )';
			}
		} if (Keys.right) {
			plane.style.transform += 'rotate( 3deg )';
		} else if (Keys.left) {
			plane.style.transform += 'rotate( -3deg )';
		} if (Keys.enter) {
			if (!executed) {
				boostDown()
			}
		}if (!Keys.enter){  
          if(executed){ 
            boostUp()
          } 
          }
		if (Keys.space) {  			
			Planes[0].Fire(); 		
			Keys.space = false; 		
		}
          requestAnimationFrame(function() { Planes[0].Move() }); }
	Fire() {
		var bullet = new Bullet(20, 20 , "https://i.ibb.co/8zTJrZC/bullet.png")
		Bullets.push(bullet);
		Bullets[0].makeBullet()
	}
}
class Bullet{
	width;
	height;
	img;
	constructor(width, height, img){
		this.width = width;
		this.height = height;
		this.img = img;
		
	}
	makeBullet() {
		var trany = 0;
		var saved = saved_moves
		var i = 5;
		const audio = new Audio("https://sndup.net/xtw5/d");
		audio.volume = 0.9;
		audio.play();
		var bullet = document.createElement("img")
		bullet.src = this.img;
		bullet.style.position = "absolute";
		bullet.style.width = this.width + "px";
		bullet.style.height = this.height + "px";
		bullet.setAttribute("class", "bullet")
		bullet.style.zIndex = "0"
		bullet.style.top = parseInt(document.getElementById("plane1").style.top) +50 +"px";
		bullet.style.left = parseInt(document.getElementById("plane1").style.left) + 40+"px"
		bullet.style.transform = saved_moves;
		document.getElementById("container").append(bullet)
		var inter = setInterval(function() {
			trany -= 7;
			bullet.style.transform = saved + 'translateY(' + trany + 'vmin)';
			var bullets = document.getElementsByClassName("bullet")
			for (var i = 0; i < bullets.length; i++) {
				const bounding = bullets[i].getBoundingClientRect();

				if (bounding.top < 0 || bounding.left < 0 || bounding.bottom > (window.innerHeight || document.documentElement.clientHeight) || bounding.right > (window.innerWidth || document.documentElement.clientWidth)) {
					clearInterval(inter)
					document.getElementById("container").removeChild(bullets[i])
					trany = 0;
				}
			}
		}, 40)
	}
}
window.onkeyup = function(e) {
	var kc = e.keyCode;
	if(kc === 32){ Keys.space = true;}
    else if(kc === 13){ Keys.enter = false;}
    else if ( kc === 39 ){ Keys.right = false;}
    else if ( kc === 38 ){ Keys.up = false;}
    else if ( kc === 37 ){ Keys.left = false;}

};

window.onload = function() {
	makePlane();
	update()
	const slider = document.getElementById("boost")
	const min = slider.min
	const max = slider.max
	const value = slider.value

	slider.style.background = `linear-gradient(to right, lime 0%, lime ${(value-min)/(max-min)*100}%, black ${(value-min)/(max-min)*100}%, black 100%)`

	slider.oninput = function() {
	  this.style.background = `linear-gradient(to right, lime 0%, lime ${(this.value-this.min)/(this.max-this.min)*100}%, black ${(this.value-this.min)/(this.max-this.min)*100}%, black 100%)`
	};
	
}

function makePlane() {
	plane = new Plane(100, 100, "https://i.pinimg.com/originals/3b/03/94/3b0394153492f7a2e31e80bb9e4c4fb5.gif" , "plane1")
	Planes.push(plane)
	Planes[0].makePlane();
}

function update() {
	requestAnimationFrame(function() {
		Planes[0].Move()
	});
}
function fpsMeter() {
    let prevTime = Date.now(),
        frames = 0;

    requestAnimationFrame(function loop() {
      const time = Date.now();
      frames++;
      if (time > prevTime + 1000) {
        let fps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );
        prevTime = time;
        frames = 0;
        document.getElementById("text").innerHTML = "";
        document.getElementById("text").innerHTML = "FPS: "+fps;
      }

      requestAnimationFrame(loop);
    });
}
  
  fpsMeter();


function boostDown() {
	
	var boost = document.getElementById("boost")
	if(Keys.enter){
      if (!executed) {
    	  clearInterval(boostInter)
		if(boostDur > 10){
			executed = true;
		audioBoost.volume = 0.9;
		audioBoost.play();
		speed = 10.0;
		boostInterval = setInterval(function() {
			if(boostDur > 0){
			boostDur = boostDur - 10;
			boost.value = boostDur
			boost.style.background = `linear-gradient(to right, lime 0%, lime ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black 100%)`
			}
			else{
				console.log(boostDur)
				clearInterval(boostInterval);
				boostUp()
				
			}
		}, 1000)
		}
	
	}
      
	
      }
	}

function boostUp(){
	if(executed){
		executed = false;
	var boost = document.getElementById("boost")
	clearInterval(boostInterval);
	speed = 6.0;
	audioBoost.pause();
	audioBoost.currentTime = 0;
	if(boostDur != 60){
		
	boostInter = setInterval(function() {
		boostDur = boostDur + 5;
		boost.value = boostDur
		boost.style.background = `linear-gradient(to right, lime 0%, lime ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black ${(boost.value-boost.min)/(boost.max-boost.min)*100}%, black 100%)`
	}, 1000)
	}
	else{
		clearInterval(boostInter)
	}
	}
}

</script>
<style>
html, body {
	font-size: 18px;
	margin: 0; /* remove default margin */
	padding: 0; /* remove default padding */
	width: 100%; /* take full browser width */
	height: 100%; /* take full browser height*/
	overflow-x: hidden;
}

#plane1 {
	transform-origin: center top;
	touch-action: none;
}

body {
	background-image:
		url('https://upload.wikimedia.org/wikipedia/commons/e/e4/StarfieldSimulation.gif');
	background-size: cover;
}

body::-webkit-scrollbar {
	display: none;
}

#plane1 {
	-khtml-user-select: none;
	-o-user-select: none;
	-moz-user-select: none;
	-webkit-user-select: none;
	user-select: none;
}

#container {
	position: relative;
	width: 100%;
	height: 100%;
	overflow: hidden;
}

#board {
	display: table;
	position: absolute;
	left: 0;
	top: 0;
	width: 300px;
	height: 50px;
	color: white;
}

#fps {
	position: fixed;
	left: 95%;
	top: 0%;
	color: white;
	width: 100px;
	height: 50px;
}

#boost {
	border-radius: 8px;
	height: 4px;
	width: 100px;
	outline: none;
	-webkit-appearance: none;
	border: white solid 0.9px;
}

input[type='range']::-webkit-slider-thumb {
	display: none;
}
</style>
</head>
<body>


	<div id="container"></div>
	<div id="board">
		<h2 id="score">Score: 0</h2>
		<!-- 		<h2 id="boost">Boost: Ready</h2> -->
		<input id="boost" type="range" min="0" value="60" max="60" />
	</div>
	<div id="fps">
		<p id="text">
	</div>
	<script>
	var Keys = {
		    up: false,
		    left: false,
		    right: false,
		    enter: false,
		    space:false
		  }
	
		  window.onkeydown = function( e ) {
		    var kc = e.keyCode;
		    if(kc === 32){ Keys.space = false;}
		    else if(kc === 13){ Keys.enter = true;}
		    else if ( kc === 39 ){ Keys.right = true;}
		    else if ( kc === 38 ){ Keys.up = true;}
		    else if ( kc === 37 ){ Keys.left = true;}
		  };
		  
		  
	</script>

</body>
</html>